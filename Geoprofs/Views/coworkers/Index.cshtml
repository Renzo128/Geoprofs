@model IEnumerable<Geoprofs.Models.Coworker>
@using Newtonsoft.Json;



@{
    ViewData["Title"] = "Index";//datum ophalen / zette
    int Jaar = DateTime.Now.Year;
    int Januari = 31;
    int Schrikkeljaar = Jaar % 4;
    int Februari;
    if(Schrikkeljaar == 0)
    {
        Februari = 29;
    }
    else
    {
        Februari = 28;
    }
    int Maart = 31;
    int April = 30;
    int Mei = 31;
    int Juni = 30;
    int Juli = 31;
    int Augustus = 31;
    int September = 30;
    int Oktober = 31;
    int November = 30;
    int December = 31;

    int[] arr = { 0,Januari, Februari, Maart, April, Mei, Juni, Juli, Augustus, September, Oktober, November, December }; 
    int currentMonth = DateTime.Now.Month;
    int currentYear = DateTime.Now.Year;
    int CurrentMonth = DateTime.Now.Month;

    int CurrentMonth2 = DateTime.Now.Month;
    int currentYear2 = DateTime.Now.Year;
    int currentday = DateTime.Now.Day;
    if(TempData["month"] != null && TempData["Year"] != null)
    {
        currentMonth =(int) TempData["month"];
        currentYear =(int) TempData["Year"];
        CurrentMonth = (int)TempData["month"];


    }

    int VorigeMaand = 0;
    int MomenteleMaand = 0;
    int Loop = 1;
    int volgendemaand = 0;
    int MomenteleMaand2 = 0;
    while (Loop != 13)
    {
        if(Loop == CurrentMonth)
        {
            if(Loop == 1)
            {
                VorigeMaand = arr[11];
                volgendemaand = arr[Loop + 1];
            }
            else if(Loop == 12)
            {
                volgendemaand = arr[1];
                VorigeMaand = arr[Loop - 1];
            }
            else
            {
                VorigeMaand = arr[Loop - 1];
                volgendemaand = arr[Loop + 1];
            }
            MomenteleMaand = arr[Loop];
            MomenteleMaand2 = arr[Loop];
        }
        Loop++;
    }

    DateTime value = new DateTime(currentYear, currentMonth, 1);
    int StartDayLastMonth = (int)value.DayOfWeek;
    if(StartDayLastMonth != 0)
    {
    StartDayLastMonth = StartDayLastMonth - 1;
    }




}
<h1 style="margin-bottom: 50px;">Verlof planning</h1>
<div class="root-container">
<div class="text-container">
<p><strong>Maand:</strong> @currentMonth</p>
<p><strong>Jaar:</strong> @currentYear</p>
</div>
<div class="button-container">  <!-- naar vorige maand-->
@using (Html.BeginForm("PastMonth", "AbsenceRequests"))
{
    <input type="hidden" name="month" value="@currentMonth" id="month"/>
    <input type="hidden" name="year" value="@currentYear" id="year"/>

    <button type="submit" class="button">Vorige</button>
}

@using (Html.BeginForm("NextMonth", "AbsenceRequests")) //naar volgende maand gaan
{
        <input type="hidden" name="month" value="@currentMonth" id="month"/>
    <input type="hidden" name="year" value="@currentYear" id="year"/>
    <button type="submit" class="button">Volgende</button>
}
</div>
</div>

@{
    // ophalen welke dag de maand begint
    int displayLoop = 1;
    int FullWeek = 1;
    int lastmonth = 0;
    int displayLoop2 = 1;
    int FullWeek2 = 1;
    int fixCounter = 0;

    int displayLastMonth = VorigeMaand - StartDayLastMonth;
    int displayLastMonth2 = VorigeMaand - StartDayLastMonth;
    int currentdayToday = (int)DateTime.Now.DayOfWeek;
    int useLastMonth = 0;
    int usedWeeks = 0;
    while(currentdayToday != 1){

    currentday = currentday - 1;
    currentdayToday = currentdayToday - 1;
    if(currentday == 0){
    useLastMonth = 1;
    }


    }

    currentday = currentday;

}


@while (displayLoop <= MomenteleMaand){
    if(FullWeek == 1)
    {
            @:<div class="row">

    }


        @while(displayLastMonth != VorigeMaand){    // vorige maand
            displayLastMonth++; // alle dagen van de vorige maand die eindigt in de momentele maand displayen

                @:<div class="col single-day last-month">
            <p class="number">
                    @displayLastMonth
                    </p>
        @foreach (var item in Model)
        {
            @foreach (var item2 in item.AbsenceRequest)
            {
                    TempData.Keep("supervisor");    // verlof hoort bij de afdeling en is goedgekeurd
                    TempData.Keep("user_id");

                if (item.supervisor == (int)TempData["supervisor"] && item2.absenceStatus == "Geaccepteerd"|| (int)TempData["role"] == 6 && item2.absenceStatus == "Geaccepteerd" && item2.coworker.position < 6 || (int)TempData["role"] == 7 && item2.absenceStatus == "Geaccepteerd" )
                { 

                    TempData.Keep("supervisor");

                int start = item2.AbsenceStart.Day; // verlof informatie ophalen
                int end = (int)item2.AbsenceEnd.Day;
                int startmonth = item2.AbsenceStart.Month;
                int endmonth = item2.AbsenceEnd.Month;
                int LastMonthForDisplay = currentMonth - 1;
                int StartYear = item2.AbsenceStart.Year;
                int endYear = item2.AbsenceEnd.Year;
                    int startyear = item2.AbsenceStart.Year;
                    DateTime longVacationStart = item2.AbsenceStart;
                DateTime longVacationEnd = item2.AbsenceEnd;
                longVacationEnd = longVacationEnd.AddMonths(-1);

                if (currentYear <= StartYear && currentYear >= endYear && start <= displayLastMonth && LastMonthForDisplay == startmonth && endmonth > LastMonthForDisplay || currentYear <= StartYear && currentYear >= endYear && start <= displayLastMonth && LastMonthForDisplay == startmonth && endmonth == LastMonthForDisplay && end >= displayLastMonth ||currentYear <= StartYear && currentYear >= endYear && startmonth <= CurrentMonth && endmonth >= currentMonth && longVacationEnd > longVacationStart)
                {
                    <p class="name @item.Position.positionName " >    <!-- verlof dispalyen-->
                        @Html.DisplayFor(modelItem => item.CoworkerName)
                    </p>
                }

            }
                    TempData.Keep("supervisor");

        }
    }
                @:</div>
            FullWeek++; 
        }

    <div class="col single-day">
        <p class="number">
            @displayLoop
            </p>


    @foreach (var item in Model) {  // momentele maand

            @foreach (var item2 in item.AbsenceRequest)
            {
                TempData.Keep("supervisor");
                TempData.Keep("user_id");
                if (item.supervisor == (int)TempData["supervisor"] && item2.absenceStatus == "Geaccepteerd"|| (int)TempData["role"] == 6 && item2.absenceStatus == "Geaccepteerd" && item2.coworker.position < 6 || (int)TempData["role"] == 7 && item2.absenceStatus == "Geaccepteerd" )
                {
                    TempData.Keep("supervisor");
                    int start = item2.AbsenceStart.Day; //verlof data ophalen
                    int end = (int)item2.AbsenceEnd.Day;
                    int startmonth = item2.AbsenceStart.Month;
                    int endmonth = item2.AbsenceEnd.Month;
                    int startyear = item2.AbsenceStart.Year;
                    int endyear = item2.AbsenceEnd.Year;



                    if (currentYear == startyear && currentYear == endyear && start <= displayLoop && end >= displayLoop && currentMonth == startmonth && currentMonth == endmonth || currentYear == startyear && startmonth < currentMonth && endmonth >= currentMonth && end >= displayLoop || currentYear == startyear && startmonth < currentMonth && endmonth > currentMonth || currentYear == startyear && startmonth == currentMonth && endmonth > currentMonth && start <= displayLoop||currentYear == startyear && currentYear == endyear && endmonth >= currentMonth && end >= displayLoop && startyear < currentYear)
                    {
                        <p class="name @item.Position.positionName">    <!-- verlof displayen-->

                            @Html.DisplayFor(modelItem => item.CoworkerName)
                        </p>
                    }
                }
            }
        }
    </div>

    if(displayLoop == MomenteleMaand && FullWeek != 7)
    {
        
            displayLastMonth = 0;
        

        @while (FullWeek != 7) {    // volgende maand displayen
            displayLastMonth++;

            @:<div class="col single-day next-month">
                <p class="number">
            @displayLastMonth
            </p>
            @foreach (var item in Model)
            {
                @foreach (var item2 in item.AbsenceRequest)
                {
                    TempData.Keep("supervisor");
                    TempData.Keep("user_id");//verlof data van de afdeling inzien die is geaccepteerd
                    if (item.supervisor == (int)TempData["supervisor"] && item2.absenceStatus == "Geaccepteerd"|| (int)TempData["role"] == 6 && item2.absenceStatus == "Geaccepteerd" && item2.coworker.position < 6 || (int)TempData["role"] == 7 && item2.absenceStatus == "Geaccepteerd" )
                    {
                    TempData.Keep("supervisor");

                        int start = item2.AbsenceStart.Day;
                        int end = (int)item2.AbsenceEnd.Day;
                        int startmonth = item2.AbsenceStart.Month;
                        int endmonth = item2.AbsenceEnd.Month;
                        int NextMonthForDisplay = currentMonth + 1;
                        if (NextMonthForDisplay == 13)
                        {
                            NextMonthForDisplay = 1;
                        }
                        DateTime longVacationStart = item2.AbsenceStart;
                        DateTime longVacationEnd = item2.AbsenceEnd;
                        longVacationEnd = longVacationEnd.AddMonths(-1);
                        int endyear = item2.AbsenceEnd.Year;
                        int startyear = item2.AbsenceStart.Year;
                        if (currentYear <= endyear && currentYear >= startyear && end >= displayLastMonth && endmonth >= NextMonthForDisplay ||currentYear <= endyear && currentYear >= startyear && NextMonthForDisplay > startmonth && NextMonthForDisplay == endmonth && start >= displayLastMonth||currentYear <= endyear && currentYear >= startyear && startmonth <= CurrentMonth && endmonth >= currentMonth && longVacationEnd > longVacationStart && end <= NextMonthForDisplay||currentYear <= endyear && currentYear >= startyear && startmonth == CurrentMonth &&  start >= displayLastMonth  && longVacationEnd > longVacationStart)

                        {   
<!-- verlof displayen-->
                            <p class="name @item.Position.positionName">
                                @Html.DisplayFor(modelItem => item.CoworkerName)
                            </p>
                        }
                    }
                }
        }
            @:</div>
            FullWeek++;
        }
    }




    @if(FullWeek == 7){
        FullWeek = 0;
        @:</div>
    }
    FullWeek++;

    displayLoop++;

}
<div class="row legenda-container">
    <span class="legenda finance"><p>Finance</p>  <p>@TempData["teamAbsence1"] % </p></span>
    <span class="legenda relation management"><p>Relation Management </p>  <p>@TempData["teamAbsence2"] %</span>
    <span class="legenda geodesy"><p>Geodesy </p>  <p>@TempData["teamAbsence3"] %</span>
    <span class="legenda geo-ICT"><p>Geo-ICT </p>  <p>@TempData["teamAbsence4"] %</span>
    <span class="legenda ict"><p>ICT </p>  <p>@TempData["teamAbsence5"] %</span>
    <span class="legenda hrm"><p>HRM </p>  <p>@TempData["teamAbsence6"] %</span>
    <span class="legenda ceo"><p>CEO </p>  <p>@TempData["teamAbsence7"] %</span>
            @if (TempData["teamAbsence"] != null) {

        TempData.Keep("teamAbsence1");
        TempData.Keep("teamAbsence2");
        TempData.Keep("teamAbsence3");
        TempData.Keep("teamAbsence4");
        TempData.Keep("teamAbsence5");
        TempData.Keep("teamAbsence6");
        TempData.Keep("teamAbsence7");

    }

</div>

@while (displayLoop2 <= MomenteleMaand2 && usedWeeks != 3){
    if(FullWeek2 == 1)
    {
            @:<div class="row">
            usedWeeks = usedWeeks + 1;
    }


        @while(VorigeMaand != VorigeMaand){    // vorige maand
            displayLastMonth2++; // alle dagen van de vorige maand die eindigt in de momentele maand displayen
        @:<div class="col single-day last-month">
            <p class="number">
                    @currentday
                    </p>
        @foreach (var item in Model)
        {
            @foreach (var item2 in item.AbsenceRequest)
            {
                    TempData.Keep("supervisor");    // verlof hoort bij de afdeling en is goedgekeurd
                    TempData.Keep("user_id");

                if (item.supervisor == (int)TempData["supervisor"] && item2.absenceStatus == "Geaccepteerd")
                { 

                    TempData.Keep("supervisor");

                int start = item2.AbsenceStart.Day; // verlof informatie ophalen
                int end = (int)item2.AbsenceEnd.Day;
                int startmonth = item2.AbsenceStart.Month;
                int endmonth = item2.AbsenceEnd.Month;
                int LastMonthForDisplay = CurrentMonth2 - 1;
                int StartYear = item2.AbsenceStart.Year;
                int endYear = item2.AbsenceEnd.Year;
                    int startyear = item2.AbsenceStart.Year;
                    DateTime longVacationStart = item2.AbsenceStart;
                DateTime longVacationEnd = item2.AbsenceEnd;
                longVacationEnd = longVacationEnd.AddMonths(-1);

                if (currentYear <= StartYear && currentYear >= endYear && start <= currentday && end >= currentday && endmonth > LastMonthForDisplay || currentYear <= StartYear && currentYear >= endYear && start <= displayLastMonth && LastMonthForDisplay == startmonth && endmonth == LastMonthForDisplay && end >= displayLastMonth ||currentYear <= StartYear && currentYear >= endYear && startmonth <= CurrentMonth2 && endmonth >= CurrentMonth2 && longVacationEnd > longVacationStart)
                {
                    <p class="name @item.Position.positionName " >    <!-- verlof dispalyen-->
                        @Html.DisplayFor(modelItem => item.CoworkerName)
                    </p>
                }

            }
                    TempData.Keep("supervisor");

        }
    }
                @:</div>
        FullWeek2++;
        fixCounter++;
    }
    @if (usedWeeks != 3 && currentday <= MomenteleMaand2) {



    <div class="col single-day">
        <p class="number">
            @currentday
            </p>


    @foreach (var item in Model) {  // momentele maand

            @foreach (var item2 in item.AbsenceRequest)
            {
                TempData.Keep("supervisor");
                TempData.Keep("user_id");
                if (item.supervisor == (int)TempData["supervisor"] && item2.absenceStatus == "Geaccepteerd")
                {
                    TempData.Keep("supervisor");
                    int start = item2.AbsenceStart.Day; //verlof data ophalen
                    int end = (int)item2.AbsenceEnd.Day;
                    int startmonth = item2.AbsenceStart.Month;
                    int endmonth = item2.AbsenceEnd.Month;
                    int startyear = item2.AbsenceStart.Year;
                    int endyear = item2.AbsenceEnd.Year;



                    if (currentYear == startyear && currentYear == endyear && start <= displayLoop2  && CurrentMonth2 == startmonth && CurrentMonth2 == endmonth || currentYear == startyear && startmonth < CurrentMonth2 && endmonth >= CurrentMonth2 && end >= displayLoop || currentYear == startyear && startmonth < CurrentMonth2 && endmonth > CurrentMonth2 || currentYear == startyear && startmonth == CurrentMonth2 && endmonth > CurrentMonth2 && start <= displayLoop||currentYear == startyear && currentYear == endyear && endmonth >= CurrentMonth2 && end >= displayLoop && startyear < currentYear)
                    {
                        <p class="name @item.Position.positionName">    <!-- verlof displayen-->

                            @Html.DisplayFor(modelItem => item.CoworkerName)
                        </p>
                    }
                }
            }
        }
    
        </div>
        if (currentday != MomenteleMaand2)
        {
            currentday++;
        }



    }

    if(currentday == MomenteleMaand2 && FullWeek2 != 7)
    {
        displayLastMonth2 = 0;
        currentday = 0;


        @while (FullWeek2 != 7 && usedWeeks != 3) {    // volgende maand displayen
            displayLastMonth2++;
            currentday++;
            int dayOfWeek = (int)DateTime.Now.DayOfWeek - 1;
            if(fixCounter == dayOfWeek)
            {
            }
            if(fixCounter == 6)
            {
                fixCounter = 0;
            }
    fixCounter++;



            @:<div class="col single-day next-month">
                <p class="number">
            @currentday
            </p>
            @foreach (var item in Model)
            {
                @foreach (var item2 in item.AbsenceRequest)
                {
                    TempData.Keep("supervisor");
                    TempData.Keep("user_id");//verlof data van de afdeling inzien die is geaccepteerd
                    if (item.supervisor == (int)TempData["supervisor"] && item2.absenceStatus == "Geaccepteerd")
                    {
                    TempData.Keep("supervisor");

                        int start = item2.AbsenceStart.Day;
                        int end = (int)item2.AbsenceEnd.Day;
                        int startmonth = item2.AbsenceStart.Month;
                        int endmonth = item2.AbsenceEnd.Month;
                        int NextMonthForDisplay = CurrentMonth2 + 1;
                        if (NextMonthForDisplay == 13)
                        {
                            NextMonthForDisplay = 1;
                        }
                        DateTime longVacationStart = item2.AbsenceStart;
                        DateTime longVacationEnd = item2.AbsenceEnd;
                        longVacationEnd = longVacationEnd.AddMonths(-1);
                        int endyear = item2.AbsenceEnd.Year;
                        int startyear = item2.AbsenceStart.Year;
                        if (currentYear <= endyear && currentYear >= startyear && end >= currentday && endmonth >= NextMonthForDisplay ||currentYear <= endyear && currentYear >= startyear && NextMonthForDisplay > startmonth && NextMonthForDisplay == endmonth && start >= currentday||currentYear <= endyear && currentYear >= startyear && startmonth <= CurrentMonth2 && endmonth >= CurrentMonth2 && longVacationEnd > longVacationStart && end <= NextMonthForDisplay||currentYear <= endyear && currentYear >= startyear && startmonth == CurrentMonth2 &&  start >= currentday  && longVacationEnd > longVacationStart)

                        {   
<!-- verlof displayen-->
                            <p class="name @item.Position.positionName">
                                @Html.DisplayFor(modelItem => item.CoworkerName)
                            </p>
                        }
                    }
                }
        }
            @:</div>
            FullWeek2++;
        }
    }




    @if(FullWeek2 == 7){
            currentday++;

        FullWeek2 = 0;
        @:</div>
    }
    FullWeek2++;

    displayLoop2++;

}