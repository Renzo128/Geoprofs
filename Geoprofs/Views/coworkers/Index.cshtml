@model IEnumerable<Geoprofs.Models.Coworker>
@using Newtonsoft.Json;



@{
    ViewData["Title"] = "Index";//datum ophalen / zette
    int Jaar = DateTime.Now.Year;
    int Januari = 31;
    int Schrikkeljaar = Jaar % 4;
    int Februari;
    if(Schrikkeljaar == 0)
    {
        Februari = 29;
    }
    else
    {
        Februari = 28;
    }
    int Maart = 31;
    int April = 30;
    int Mei = 31;
    int Juni = 30;
    int Juli = 31;
    int Augustus = 31;
    int September = 30;
    int Oktober = 31;
    int November = 30;
    int December = 31;

    int[] arr = { 0,Januari, Februari, Maart, April, Mei, Juni, Juli, Augustus, September, Oktober, November, December }; 
    int currentMonth = DateTime.Now.Month;
    int currentYear = DateTime.Now.Year;
    int CurrentMonth = DateTime.Now.Month;

    if(TempData["month"] != null && TempData["Year"] != null)
    {
        currentMonth =(int) TempData["month"];
        currentYear =(int) TempData["Year"];
        CurrentMonth = (int)TempData["month"];


    }

    int VorigeMaand = 0;
    int MomenteleMaand = 0;
    int Loop = 1;
    int volgendemaand = 0;
    while (Loop != 13)
    {
        if(Loop == CurrentMonth)
        {
            if(Loop == 1)
            {
                VorigeMaand = arr[11];
                volgendemaand = arr[Loop + 1];
            }
            else if(Loop == 12)
            {
                volgendemaand = arr[1];
                VorigeMaand = arr[Loop - 1];
            }
            else
            {
                VorigeMaand = arr[Loop - 1];
                volgendemaand = arr[Loop + 1];
            }
            MomenteleMaand = arr[Loop];
        }
        Loop++;
    }

    DateTime value = new DateTime(currentYear, currentMonth, 1);
    int StartDayLastMonth = (int)value.DayOfWeek;
    if(StartDayLastMonth != 0)
    {
    StartDayLastMonth = StartDayLastMonth - 1;
    }



}
<h1 style="margin-bottom: 50px;">Verlof planning</h1>
<div class="root-container">
<div class="text-container">
<p><strong>Maand:</strong> @currentMonth</p>
<p><strong>Jaar:</strong> @currentYear</p>
</div>
<div class="button-container">  <!-- naar vorige maand-->
@using (Html.BeginForm("PastMonth", "AbsenceRequests"))
{
    <input type="hidden" name="month" value="@currentMonth" id="month"/>
    <input type="hidden" name="year" value="@currentYear" id="year"/>

    <button type="submit" class="button">Vorige</button>
}

@using (Html.BeginForm("NextMonth", "AbsenceRequests")) //naar volgende maand gaan
{
        <input type="hidden" name="month" value="@currentMonth" id="month"/>
    <input type="hidden" name="year" value="@currentYear" id="year"/>
    <button type="submit" class="button">Volgende</button>
}
</div>
</div>

@{  // ophalen welke dag de maand begint
    int displayLoop = 1;
    int FullWeek = 1;
    int lastmonth = 0;

    int displayLastMonth = VorigeMaand - StartDayLastMonth;
}


@while (displayLoop <= MomenteleMaand){
    if(FullWeek == 1)
    {
            @:<div class="row">

    }


        @while(displayLastMonth != VorigeMaand){    // vorige maand
            displayLastMonth++; // alle dagen van de vorige maand die eindigt in de momentele maand displayen

                @:<div class="col single-day last-month">
            <p class="number">
                    @displayLastMonth
                    </p>
        @foreach (var item in Model)
        {
            @foreach (var item2 in item.AbsenceRequest)
            {
                    TempData.Keep("supervisor");    // verlof hoort bij de afdeling en is goedgekeurd

                if (item.supervisor == (int)TempData.Peek("supervisor") && item2.absenceStatus == "Geaccepteerd")
                { 

                    TempData.Keep("supervisor");

                int start = item2.AbsenceStart.Day; // verlof informatie ophalen
                int end = (int)item2.AbsenceEnd.Day;
                int startmonth = item2.AbsenceStart.Month;
                int endmonth = item2.AbsenceEnd.Month;
                int LastMonthForDisplay = currentMonth - 1;
                int StartYear = item2.AbsenceStart.Year;
                int endYear = item2.AbsenceEnd.Year;
                DateTime longVacationStart = item2.AbsenceStart;
                DateTime longVacationEnd = item2.AbsenceEnd;
                longVacationEnd = longVacationEnd.AddMonths(-1);

                if (currentYear <= StartYear && start <= displayLastMonth && LastMonthForDisplay == startmonth && endmonth > LastMonthForDisplay || currentYear <= StartYear && start <= displayLastMonth && LastMonthForDisplay == startmonth && endmonth == LastMonthForDisplay && end >= displayLastMonth ||currentYear <= StartYear && startmonth <= CurrentMonth && endmonth >= currentMonth && longVacationEnd > longVacationStart)
                {
                    <p class="name">    <!-- verlof dispalyen-->
                        @Html.DisplayFor(modelItem => item.CoworkerName)
                    </p>
                }

            }
                    TempData.Keep("supervisor");

        }
    }
                @:</div>
            FullWeek++; 
        }

    <div class="col single-day">
        <p class="number">
            @displayLoop
            </p>


    @foreach (var item in Model) {  // momentele maand

            @foreach (var item2 in item.AbsenceRequest)
            {
                TempData.Keep("supervisor");
                if (item.supervisor == (int)TempData["supervisor"] && item2.absenceStatus == "Geaccepteerd"|| (int)TempData["role"] == 6 && item2.absenceStatus == "Geaccepteerd" && item2.coworker.position < 6 || (int)TempData["role"] == 7 && item2.absenceStatus == "Geaccepteerd" )
                {
                    TempData.Keep("supervisor");
                    int start = item2.AbsenceStart.Day; //verlof data ophalen
                    int end = (int)item2.AbsenceEnd.Day;
                    int startmonth = item2.AbsenceStart.Month;
                    int endmonth = item2.AbsenceEnd.Month;
                    int startyear = item2.AbsenceStart.Year;
                    int endyear = item2.AbsenceEnd.Year;



                    if (currentYear >= startyear && currentYear <= endyear && start <= displayLoop && end >= displayLoop && currentMonth == startmonth && currentMonth == endmonth || currentYear == startyear && startmonth < currentMonth && endmonth >= currentMonth && end >= displayLoop || currentYear == startyear && startmonth < currentMonth && endmonth > currentMonth || currentYear == startyear && startmonth == currentMonth && endmonth > currentMonth && start <= displayLoop||currentYear >= startyear && currentYear <= endyear && endmonth >= currentMonth && end >= displayLoop && startyear < currentYear)
                    {
                        <p class="name">    <!-- verlof displayen-->

                            @Html.DisplayFor(modelItem => item.CoworkerName)
                        </p>
                    }
                }
            }
        }
    </div>

    if(displayLoop == MomenteleMaand && FullWeek != 7)
    {
        
            displayLastMonth = 0;
        

        @while (FullWeek != 7) {    // volgende maand displayen
            displayLastMonth++;

            @:<div class="col single-day next-month">
                <p class="number">
            @displayLastMonth
            </p>
            @foreach (var item in Model)
            {
                @foreach (var item2 in item.AbsenceRequest)
                {
                    TempData.Keep("supervisor");    //verlof data van de afdeling inzien die is geaccepteerd
                    if (item.supervisor == (int)TempData["supervisor"] && item2.absenceStatus == "Geaccepteerd")
                    {
                    TempData.Keep("supervisor");

                        int start = item2.AbsenceStart.Day;
                        int end = (int)item2.AbsenceEnd.Day;
                        int startmonth = item2.AbsenceStart.Month;
                        int endmonth = item2.AbsenceEnd.Month;
                        int NextMonthForDisplay = currentMonth + 1;
                        if (NextMonthForDisplay == 13)
                        {
                            NextMonthForDisplay = 1;
                        }
                        DateTime longVacationStart = item2.AbsenceStart;
                        DateTime longVacationEnd = item2.AbsenceEnd;
                        longVacationEnd = longVacationEnd.AddMonths(-1);
                        int endyear = item2.AbsenceEnd.Year;
                        if (currentYear < endyear && end >= displayLastMonth && endmonth >= NextMonthForDisplay || NextMonthForDisplay > startmonth && NextMonthForDisplay == endmonth && start >= displayLastMonth||currentYear <= endyear && startmonth <= CurrentMonth && endmonth >= currentMonth && longVacationEnd > longVacationStart && end <= NextMonthForDisplay||currentYear <= endyear && startmonth == CurrentMonth &&  start >= displayLastMonth  && longVacationEnd > longVacationStart)

                        {   <!-- verlof displayen-->
                            <p class="name">
                                @Html.DisplayFor(modelItem => item.CoworkerName)
                            </p>
                        }
                    }
                }
        }
            @:</div>
            FullWeek++;
        }
    }




    @if(FullWeek == 7){
        FullWeek = 0;
        @:</div>
    }
    FullWeek++;

    displayLoop++;

}
